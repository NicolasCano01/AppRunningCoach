<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="Running Coach Pro - Training History Management">
  <meta name="theme-color" content="#0ea5e9">
  <title>Running Coach Pro - Session History</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600;9..40,700;9..40,800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  
  <style>
    :root {
      --bg-primary: #0a0f1a;
      --bg-secondary: #111827;
      --bg-card: #1a2332;
      --bg-elevated: #243044;
      --accent-blue: #3b82f6;
      --accent-cyan: #06b6d4;
      --accent-emerald: #10b981;
      --accent-amber: #f59e0b;
      --accent-rose: #f43f5e;
      --accent-purple: #8b5cf6;
      --text-primary: #f8fafc;
      --text-secondary: #94a3b8;
      --text-muted: #64748b;
      --border-color: #334155;
    }
    
    * { 
      font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
      box-sizing: border-box;
    }
    
    .mono { font-family: 'Space Mono', monospace; }
    
    body {
      background: linear-gradient(135deg, var(--bg-primary) 0%, #0f172a 50%, #1e1b4b 100%);
      min-height: 100vh;
      color: var(--text-primary);
      margin: 0;
      padding: 0 0 80px 0;
    }

    /* Bottom Navigation */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(26, 35, 50, 0.98);
      backdrop-filter: blur(20px);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      padding-bottom: env(safe-area-inset-bottom);
      z-index: 1000;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
    }
    
    .bottom-nav-container {
      display: flex;
      justify-content: space-around;
      align-items: center;
      max-width: 600px;
      margin: 0 auto;
      padding: 8px 16px;
    }
    
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 8px 12px;
      border-radius: 12px;
      text-decoration: none;
      color: var(--text-secondary);
      transition: all 0.2s;
      min-width: 60px;
      flex: 1;
      max-width: 90px;
    }
    
    .nav-item:hover {
      background: rgba(59, 130, 246, 0.1);
      color: var(--text-primary);
    }
    
    .nav-item.active {
      background: var(--accent-emerald);
      color: white;
    }
    
    .nav-item svg {
      width: 24px;
      height: 24px;
    }
    
    .nav-item span {
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    /* Card Styles */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .metric-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 12px;
      position: relative;
      transition: all 0.2s;
    }

    .metric-card:hover {
      border-color: var(--accent-blue);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
    }

    .session-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 12px;
      transition: all 0.2s;
      cursor: pointer;
    }

    .session-card:hover {
      border-color: var(--accent-blue);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
      transform: translateY(-1px);
    }

    .session-card.selected {
      border-color: var(--accent-emerald);
      background: rgba(16, 185, 129, 0.05);
    }

    /* Badge styles */
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
      gap: 4px;
    }

    .badge-blue { background: rgba(59, 130, 246, 0.2); color: #60a5fa; }
    .badge-cyan { background: rgba(6, 182, 212, 0.2); color: #22d3ee; }
    .badge-emerald { background: rgba(16, 185, 129, 0.2); color: #34d399; }
    .badge-amber { background: rgba(245, 158, 11, 0.2); color: #fbbf24; }
    .badge-purple { background: rgba(139, 92, 246, 0.2); color: #a78bfa; }
    .badge-rose { background: rgba(244, 63, 94, 0.2); color: #fb7185; }

    .filter-pill {
      padding: 8px 16px;
      border-radius: 20px;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 600;
      transition: all 0.2s;
      cursor: pointer;
    }

    .filter-pill:hover {
      border-color: var(--accent-blue);
      color: var(--text-primary);
    }

    .filter-pill.active {
      background: var(--accent-blue);
      border-color: var(--accent-blue);
      color: white;
    }

    .btn {
      padding: 10px 20px;
      border-radius: 12px;
      font-weight: 600;
      transition: all 0.2s;
      cursor: pointer;
      border: none;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: var(--accent-blue);
      color: white;
    }

    .btn-primary:hover {
      background: #2563eb;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    }

    .btn-secondary {
      background: var(--bg-card);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
      border-color: var(--accent-blue);
      color: var(--accent-blue);
    }

    .btn-small {
      padding: 6px 12px;
      font-size: 13px;
      border-radius: 8px;
    }

    .action-btn {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
    }

    .action-btn-edit {
      background: rgba(245, 158, 11, 0.2);
      color: #fbbf24;
    }

    .action-btn-edit:hover {
      background: rgba(245, 158, 11, 0.3);
      transform: scale(1.05);
    }

    .action-btn-delete {
      background: rgba(244, 63, 94, 0.2);
      color: #fb7185;
    }

    .action-btn-delete:hover {
      background: rgba(244, 63, 94, 0.3);
      transform: scale(1.05);
    }

    .pagination-btn {
      padding: 8px 16px;
      border-radius: 8px;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 13px;
    }

    .pagination-btn:hover:not(:disabled) {
      border-color: var(--accent-blue);
      color: var(--accent-blue);
    }

    .pagination-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .pagination-btn.active {
      background: var(--accent-blue);
      border-color: var(--accent-blue);
      color: white;
    }

    /* Modal Styles */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(8px);
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn 0.2s ease;
    }

    .modal-content {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 20px;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      animation: slideUp 0.3s ease;
    }

    .input-field {
      width: 100%;
      padding: 10px 14px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 14px;
      transition: all 0.2s;
    }

    .input-field:focus {
      outline: none;
      border-color: var(--accent-blue);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .input-field::placeholder {
      color: var(--text-muted);
    }

    textarea.input-field {
      resize: vertical;
      min-height: 80px;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from { 
        opacity: 0;
        transform: translateY(20px);
      }
      to { 
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .fade-in {
      animation: fadeIn 0.4s ease-out forwards;
    }

    .collapsible-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .collapsible-content.expanded {
      max-height: 500px;
    }

    .spinner {
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-top-color: var(--accent-blue);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 0.8s linear infinite;
    }

    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: var(--bg-secondary); border-radius: 4px; }
    ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #475569; }

    @media (max-width: 768px) {
      .metric-card { padding: 10px; }
      .session-card { padding: 10px; }
      .session-card .flex { flex-wrap: wrap; }
      .modal-content { 
        max-width: 100%; 
        border-radius: 20px 20px 0 0;
        max-height: 95vh;
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCQr84Yu0lTkKMnqtgYDD5NP4i_n5qS4eM",
      authDomain: "runningcoachdata.firebaseapp.com",
      projectId: "runningcoachdata",
      storageBucket: "runningcoachdata.firebasestorage.app",
      messagingSenderId: "364279562892",
      appId: "1:364279562892:web:7acd6bbac8c8113177f1a9"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.firestore();
    const auth = firebase.auth();

    // Bottom Navigation Component
    const BottomNav = ({ currentPage }) => (
      <nav className="bottom-nav">
        <div className="bottom-nav-container">
          <a href="AnalyticsPanel.html" className={`nav-item ${currentPage === 'analytics' ? 'active' : ''}`}>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
              <line x1="18" y1="20" x2="18" y2="10"></line>
              <line x1="12" y1="20" x2="12" y2="4"></line>
              <line x1="6" y1="20" x2="6" y2="14"></line>
            </svg>
            <span>Analytics</span>
          </a>
          
          <a href="HistoryPanel.html" className={`nav-item ${currentPage === 'history' ? 'active' : ''}`}>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            <span>History</span>
          </a>
          
          <a href="SmartCoachPanel.html" className={`nav-item ${currentPage === 'coach' ? 'active' : ''}`}>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
              <circle cx="12" cy="8" r="7"></circle>
              <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline>
            </svg>
            <span>Coach</span>
          </a>
          
          <a href="#" className="nav-item" onClick={(e) => { e.preventDefault(); window.openAddModal && window.openAddModal(); }}>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
              <path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"></path>
              <rect x="9" y="3" width="6" height="4" rx="1"></rect>
              <line x1="12" y1="12" x2="12" y2="12.01"></line>
              <line x1="12" y1="16" x2="12" y2="16.01"></line>
            </svg>
            <span>Log</span>
          </a>
          
          <a href="#" className={`nav-item ${currentPage === 'settings' ? 'active' : ''}`} onClick={(e) => { e.preventDefault(); alert('Settings coming soon!'); }}>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M12 1v6m0 6v6m0-6h6m-6 0H6m13.66-5.66L16 10m-8 8-3.66 3.66M1.34 6.34L5 10m8 8 3.66 3.66M18.66 1.34 15 5M9 15l-3.66 3.66"></path>
            </svg>
            <span>Settings</span>
          </a>
        </div>
      </nav>
    );

    // Main Training History Component
    function TrainingHistory() {
      const [sessions, setSessions] = useState([]);
      const [loading, setLoading] = useState(true);
      const [searchTerm, setSearchTerm] = useState('');
      const [sessionTypeFilter, setSessionTypeFilter] = useState('All Types');
      const [phaseFilter, setPhaseFilter] = useState('All Phases');
      const [quickFilter, setQuickFilter] = useState('All');
      const [showAdvancedFilters, setShowAdvancedFilters] = useState(false);
      const [fromDate, setFromDate] = useState('');
      const [toDate, setToDate] = useState('');
      const [currentPage, setCurrentPage] = useState(1);
      const [selectedSessions, setSelectedSessions] = useState([]);
      
      // Modal state
      const [showModal, setShowModal] = useState(false);
      const [modalType, setModalType] = useState('view'); // 'view', 'add', 'edit'
      const [selectedSession, setSelectedSession] = useState(null);
      const [editingSession, setEditingSession] = useState(null);
      
      const sessionsPerPage = 20;

      // Helper functions
      const parseSessionDate = (dateStr) => {
        if (!dateStr) return new Date();
        if (dateStr.includes('/')) {
          const [day, month, year] = dateStr.split('/');
          return new Date(`${year}-${month}-${day}`);
        }
        return new Date(dateStr);
      };

      const formatPace = (seconds) => {
        if (!seconds || seconds === 0) return '--:--';
        const mins = Math.floor(seconds / 60);
        const secs = Math.round(seconds % 60);
        return `${mins}:${secs.toString().padStart(2, '0')}`;
      };

      const paceToSeconds = (mmss) => {
        if (!mmss || !mmss.includes(':')) return 0;
        const [mins, secs] = mmss.split(':').map(Number);
        return mins * 60 + secs;
      };

      const formatDate = (dateStr) => {
        const date = parseSessionDate(dateStr);
        return date.toLocaleDateString('en-AU', { day: '2-digit', month: 'short', year: 'numeric' });
      };

      const getSessionIcon = (type) => {
        const icons = {
          'Pedicab': 'üö¥',
          'Futsal': '‚öΩ',
          'Easy Run': 'üèÉ',
          'Long Run': 'üèÉ‚Äç‚ôÇÔ∏è',
          'Speed Intervals': '‚ö°',
          'Tempo Run': 'üî•',
          'Cross-Training': 'üèãÔ∏è',
          'Recovery Run': 'üí§',
          'Strength Training': 'üí™'
        };
        return icons[type] || 'üèÉ';
      };

      // Load sessions from Firebase
      const loadSessions = async () => {
        try {
          await auth.signInWithEmailAndPassword('nic@runningcoach.com', 'policias');
          
          const user = auth.currentUser;
          if (!user) throw new Error('Not authenticated');

          const sessionsRef = db.collection('users').doc(user.uid).collection('sessions');
          const snapshot = await sessionsRef.orderBy('date', 'desc').get();
          
          const trainingStartDate = new Date('2025-11-10');
          const loadedSessions = snapshot.docs.map(doc => {
            const sessionData = doc.data();
            const sessionDate = parseSessionDate(sessionData.date);
            const daysSinceStart = Math.floor((sessionDate - trainingStartDate) / (1000 * 60 * 60 * 24));
            const weekNumber = Math.floor(daysSinceStart / 7) + 1;
            
            return {
              id: doc.id,
              ...sessionData,
              weekNumber: weekNumber > 0 ? weekNumber : 1
            };
          });

          setSessions(loadedSessions);
          console.log(`‚úÖ Firestore: Loaded ${loadedSessions.length} sessions`);
          setLoading(false);
        } catch (error) {
          console.error('‚ùå Error:', error);
          setLoading(false);
        }
      };

      useEffect(() => {
        loadSessions();
      }, []);

      // Apply filters
      const filteredSessions = useMemo(() => {
        let filtered = [...sessions];

        const now = new Date();
        if (quickFilter === 'Last 7 Days') {
          const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
          filtered = filtered.filter(s => parseSessionDate(s.date) >= sevenDaysAgo);
        } else if (quickFilter === 'Last 30') {
          const thirtyDaysAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
          filtered = filtered.filter(s => parseSessionDate(s.date) >= thirtyDaysAgo);
        }

        if (searchTerm) {
          const term = searchTerm.toLowerCase();
          filtered = filtered.filter(s => 
            (s.sessionType || '').toLowerCase().includes(term) ||
            (s.notes || '').toLowerCase().includes(term) ||
            (s.route || '').toLowerCase().includes(term)
          );
        }

        if (sessionTypeFilter !== 'All Types') {
          filtered = filtered.filter(s => s.sessionType === sessionTypeFilter);
        }

        if (phaseFilter !== 'All Phases') {
          filtered = filtered.filter(s => s.phase === phaseFilter);
        }

        if (fromDate) {
          const from = new Date(fromDate);
          filtered = filtered.filter(s => parseSessionDate(s.date) >= from);
        }
        if (toDate) {
          const to = new Date(toDate);
          filtered = filtered.filter(s => parseSessionDate(s.date) <= to);
        }

        return filtered;
      }, [sessions, searchTerm, sessionTypeFilter, phaseFilter, quickFilter, fromDate, toDate]);

      // Calculate summary stats (with avgHr fix - lowercase 'r')
      const summaryStats = useMemo(() => {
        const totalDistance = filteredSessions.reduce((sum, s) => {
          const dist = s.distance || 0;
          return sum + dist;
        }, 0);

        const totalTime = filteredSessions.reduce((sum, s) => {
          const duration = s.duration || 0;
          return sum + duration;
        }, 0);

        const sessionsWithHr = filteredSessions.filter(s => s.avgHr);
        const avgHR = sessionsWithHr.length > 0
          ? Math.round(sessionsWithHr.reduce((sum, s) => sum + s.avgHr, 0) / sessionsWithHr.length)
          : 0;

        const sessionsWithRPE = filteredSessions.filter(s => s.rpe);
        const avgRPE = sessionsWithRPE.length > 0
          ? (sessionsWithRPE.reduce((sum, s) => sum + s.rpe, 0) / sessionsWithRPE.length).toFixed(1)
          : 0;

        return {
          totalSessions: filteredSessions.length,
          totalDistance: totalDistance.toFixed(1),
          totalTime: Math.round(totalTime),
          avgHR,
          avgRPE
        };
      }, [filteredSessions]);

      // Session type breakdown
      const sessionTypeBreakdown = useMemo(() => {
        const breakdown = {};
        filteredSessions.forEach(s => {
          const type = s.sessionType || 'Unknown';
          breakdown[type] = (breakdown[type] || 0) + 1;
        });
        return Object.entries(breakdown)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 8);
      }, [filteredSessions]);

      // Pagination
      const totalPages = Math.ceil(filteredSessions.length / sessionsPerPage);
      const paginatedSessions = useMemo(() => {
        const startIndex = (currentPage - 1) * sessionsPerPage;
        return filteredSessions.slice(startIndex, startIndex + sessionsPerPage);
      }, [filteredSessions, currentPage]);

      const sessionTypes = useMemo(() => {
        const types = new Set(sessions.map(s => s.sessionType).filter(Boolean));
        return ['All Types', ...Array.from(types)];
      }, [sessions]);

      const phases = useMemo(() => {
        const phaseSet = new Set(sessions.map(s => s.phase).filter(Boolean));
        return ['All Phases', ...Array.from(phaseSet)];
      }, [sessions]);

      // Modal handlers
      const openViewModal = (session) => {
        setSelectedSession(session);
        setModalType('view');
        setShowModal(true);
      };

      const openAddModal = () => {
        setEditingSession({
          sessionType: 'Easy Run',
          phase: 'Base',
          date: new Date().toISOString().split('T')[0]
        });
        setModalType('add');
        setShowModal(true);
      };
      
      // Make openAddModal available globally for bottom nav
	    window.openAddModal = openAddModal;

      const openEditModal = (session) => {
        setEditingSession(session);
        setModalType('edit');
        setShowModal(true);
      };

      const closeModal = () => {
        setShowModal(false);
        setSelectedSession(null);
        setEditingSession(null);
      };

      // Save session
      const handleSaveSession = async () => {
        try {
          const user = auth.currentUser;
          if (!user) throw new Error('Not authenticated');

          const sessionData = {
            sessionType: document.getElementById('modalSessionType').value,
            date: document.getElementById('modalDate').value,
            phase: document.getElementById('modalPhase').value,
            notes: document.getElementById('modalNotes')?.value || ''
          };

          // Pedicab-specific
          if (sessionData.sessionType === 'Pedicab') {
            const hours = parseFloat(document.getElementById('modalPedicabHours').value) || 6;
            sessionData.duration = hours * 60;
            sessionData.distance = hours * 3;
            sessionData.avgPace = 390; // 6:30
            sessionData.avgHr = 120;
            sessionData.maxHr = 145;
            sessionData.rpe = 5;
          } 
          // Futsal-specific
          else if (sessionData.sessionType === 'Futsal') {
            sessionData.duration = 60;
            sessionData.distance = 8;
            sessionData.avgPace = 450; // 7:30
            sessionData.avgHr = 165;
            sessionData.maxHr = 185;
            sessionData.rpe = 8;
          }
          // Running sessions
          else {
            const distanceVal = document.getElementById('modalDistance').value;
            const durationVal = document.getElementById('modalDuration').value;
            const paceVal = document.getElementById('modalAvgPace').value;
            const rpeVal = document.getElementById('modalRpe').value;
            const avgHrVal = document.getElementById('modalAvgHr').value;
            const maxHrVal = document.getElementById('modalMaxHr').value;
            const z2PaceVal = document.getElementById('modalZ2Pace')?.value;
            const z2TimeVal = document.getElementById('modalZ2Time')?.value;
            const cadenceVal = document.getElementById('modalAvgCadence')?.value;

            if (distanceVal) sessionData.distance = parseFloat(distanceVal);
            if (durationVal) sessionData.duration = parseFloat(durationVal);
            if (paceVal) sessionData.avgPace = paceToSeconds(paceVal);
            if (rpeVal) sessionData.rpe = parseInt(rpeVal);
            if (avgHrVal) sessionData.avgHr = parseInt(avgHrVal);
            if (maxHrVal) sessionData.maxHr = parseInt(maxHrVal);
            if (z2PaceVal) sessionData.z2Pace = paceToSeconds(z2PaceVal);
            if (z2TimeVal) sessionData.z2Time = parseFloat(z2TimeVal);
            if (cadenceVal) sessionData.avgCadence = parseInt(cadenceVal);
          }
		   
		  // Calculate week number from training start date
			const trainingStartDate = new Date('2025-11-10');
			const sessionDate = new Date(sessionData.date);
			const daysSinceStart = Math.floor((sessionDate - trainingStartDate) / (1000 * 60 * 60 * 24));
			const weekNumber = Math.floor(daysSinceStart / 7) + 1;
			sessionData.weekNumber = weekNumber > 0 ? weekNumber : 1; 
		  
          if (modalType === 'add') {
            await db.collection('users').doc(user.uid).collection('sessions').add(sessionData);
            console.log('‚úÖ Session added');
          } else {
            await db.collection('users').doc(user.uid).collection('sessions')
              .doc(editingSession.id).update(sessionData);
            console.log('‚úÖ Session updated');
          }

          loadSessions();
          closeModal();
        } catch (error) {
          console.error('‚ùå Save error:', error);
          alert('Failed to save session');
        }
      };

      // Delete session
      const deleteSession = async (sessionId) => {
        if (!confirm('Are you sure you want to delete this session?')) return;
        
        try {
          const user = auth.currentUser;
          await db.collection('users').doc(user.uid).collection('sessions').doc(sessionId).delete();
          setSessions(prev => prev.filter(s => s.id !== sessionId));
          console.log('‚úÖ Session deleted');
        } catch (error) {
          console.error('‚ùå Delete error:', error);
          alert('Failed to delete session');
        }
      };

      if (loading) {
        return (
          <div className="flex items-center justify-center min-h-screen">
            <div className="text-center">
              <div className="spinner mx-auto mb-4"></div>
              <p className="text-slate-400">Loading sessions...</p>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen">
          {/* Header */}
          <div className="p-4 md:p-6">
            <div className="flex items-center justify-between mb-2">
              <h1 className="text-2xl md:text-3xl font-bold flex items-center gap-2">
                üìÖ Training History
              </h1>
            </div>
            <p className="text-sm text-slate-400">Manage and track all your training sessions</p>
          </div>

          {/* Main Content */}
          <div className="px-4 md:px-6 pb-6 space-y-4">
            
            {/* Quick Filters */}
            <div className="flex gap-2 overflow-x-auto pb-2">
              {['Last 7 Days', 'Last 30', 'All'].map(filter => (
                <button
                  key={filter}
                  className={`filter-pill ${quickFilter === filter ? 'active' : ''}`}
                  onClick={() => { setQuickFilter(filter); setCurrentPage(1); }}
                >
                  {filter}
                </button>
              ))}
              <button
                className="filter-pill"
                onClick={() => setShowAdvancedFilters(!showAdvancedFilters)}
              >
                {showAdvancedFilters ? '‚ñ≤' : '‚ñº'} Advanced
              </button>
            </div>

            {/* Advanced Filters */}
            <div className={`collapsible-content ${showAdvancedFilters ? 'expanded' : ''}`}>
              <div className="card p-4 space-y-3">
                <div>
                  <label className="block text-xs font-semibold text-slate-400 mb-1">Search</label>
                  <input
                    type="text"
                    placeholder="Search notes, routes..."
                    className="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-sm text-white focus:border-blue-500 focus:outline-none"
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                  />
                </div>

                <div className="grid grid-cols-2 gap-3">
                  <div>
                    <label className="block text-xs font-semibold text-slate-400 mb-1">Session Type</label>
                    <select
                      className="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-sm text-white focus:border-blue-500 focus:outline-none"
                      value={sessionTypeFilter}
                      onChange={(e) => setSessionTypeFilter(e.target.value)}
                    >
                      {sessionTypes.map(type => (
                        <option key={type} value={type}>{type}</option>
                      ))}
                    </select>
                  </div>

                  <div>
                    <label className="block text-xs font-semibold text-slate-400 mb-1">Phase</label>
                    <select
                      className="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-sm text-white focus:border-blue-500 focus:outline-none"
                      value={phaseFilter}
                      onChange={(e) => setPhaseFilter(e.target.value)}
                    >
                      {phases.map(phase => (
                        <option key={phase} value={phase}>{phase}</option>
                      ))}
                    </select>
                  </div>
                </div>

                <div className="grid grid-cols-2 gap-3">
                  <div>
                    <label className="block text-xs font-semibold text-slate-400 mb-1">From Date</label>
                    <input
                      type="date"
                      className="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-sm text-white focus:border-blue-500 focus:outline-none"
                      value={fromDate}
                      onChange={(e) => setFromDate(e.target.value)}
                    />
                  </div>

                  <div>
                    <label className="block text-xs font-semibold text-slate-400 mb-1">To Date</label>
                    <input
                      type="date"
                      className="w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-sm text-white focus:border-blue-500 focus:outline-none"
                      value={toDate}
                      onChange={(e) => setToDate(e.target.value)}
                    />
                  </div>
                </div>

                <button
                  className="btn btn-secondary btn-small w-full"
                  onClick={() => {
                    setSearchTerm('');
                    setSessionTypeFilter('All Types');
                    setPhaseFilter('All Phases');
                    setFromDate('');
                    setToDate('');
                    setQuickFilter('All');
                  }}
                >
                  ‚úï Clear Filters
                </button>
              </div>
            </div>

            {/* Summary Stats */}
            <div className="card p-4">
              <h3 className="text-sm font-semibold text-slate-400 mb-3">
                üìä Summary ({summaryStats.totalSessions} sessions)
              </h3>
              <div className="grid grid-cols-2 gap-3">
                <div className="metric-card">
                  <h4 className="text-xs text-slate-400 mb-1">Total Distance</h4>
                  <div className="text-2xl font-bold text-cyan-400">{summaryStats.totalDistance} km</div>
                </div>

                <div className="metric-card">
                  <h4 className="text-xs text-slate-400 mb-1">Total Time</h4>
                  <div className="text-2xl font-bold text-emerald-400">{(summaryStats.totalTime / 60).toFixed(1)} hrs</div>
                </div>

                <div className="metric-card">
                  <h4 className="text-xs text-slate-400 mb-1">Avg Heart Rate</h4>
                  <div className="text-2xl font-bold text-rose-400">{summaryStats.avgHR || '--'} bpm</div>
                </div>

                <div className="metric-card">
                  <h4 className="text-xs text-slate-400 mb-1">Avg RPE</h4>
                  <div className="text-2xl font-bold text-amber-400">{summaryStats.avgRPE}/10</div>
                </div>
              </div>
            </div>

            {/* Session Type Badges */}
            {sessionTypeBreakdown.length > 0 && (
              <div className="flex flex-wrap gap-2">
                {sessionTypeBreakdown.map(([type, count]) => {
                  const badgeColors = ['badge-blue', 'badge-cyan', 'badge-emerald', 'badge-amber', 'badge-purple', 'badge-rose'];
                  const color = badgeColors[sessionTypeBreakdown.indexOf([type, count]) % badgeColors.length];
                  return (
                    <span key={type} className={`badge ${color}`}>
                      {getSessionIcon(type)} {type} {count}
                    </span>
                  );
                })}
              </div>
            )}

            {/* Add Session Button */}
            <div className="flex justify-between items-center">
              <button className="btn btn-primary" onClick={openAddModal}>
                <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2">
                  <circle cx="10" cy="10" r="9"></circle>
                  <line x1="10" y1="6" x2="10" y2="14"></line>
                  <line x1="6" y1="10" x2="14" y2="10"></line>
                </svg>
                Add Session
              </button>
              
              <div className="text-sm text-slate-400">
                Showing {paginatedSessions.length} of {filteredSessions.length}
              </div>
            </div>

            {/* Session List */}
            <div className="space-y-2">
              {paginatedSessions.length === 0 ? (
                <div className="card p-8 text-center">
                  <p className="text-slate-400">No sessions found. Try adjusting your filters.</p>
                </div>
              ) : (
                paginatedSessions.map((session, index) => (
                  <div
                    key={session.id}
                    className="session-card fade-in"
                    style={{ animationDelay: `${index * 0.05}s` }}
                    onClick={() => openViewModal(session)}
                  >
                    <div className="flex items-center justify-between gap-4">
                      {/* Left: Icon + Type + Date */}
                      <div className="flex items-center gap-3 flex-shrink-0">
                        <div className="text-2xl">{getSessionIcon(session.sessionType)}</div>
                        <div>
                          <div className="font-semibold text-white">{session.sessionType || 'Unknown'}</div>
                          <div className="text-xs text-slate-400">
                            {formatDate(session.date)} ‚Ä¢ Week {session.weekNumber || '?'}
                          </div>
                        </div>
                      </div>

                      {/* Right: Stats inline + Actions */}
                      <div className="flex items-center gap-4">
                        {/* Stats - always inline */}
                        <div className="flex gap-4 text-xs">
                          <div className="text-right">
                            <div className="text-slate-400">Distance</div>
                            <div className="font-semibold text-cyan-400">
                              {(session.distance || 0).toFixed(1)} km
                            </div>
                          </div>
                          <div className="text-right">
                            <div className="text-slate-400">Duration</div>
                            <div className="font-semibold text-emerald-400 mono">
                              {(session.duration / 60).toFixed(1)} hrs
                            </div>
                          </div>
                          <div className="text-right">
                            <div className="text-slate-400">Pace</div>
                            <div className="font-semibold text-indigo-400 mono">
                              {formatPace(session.avgPace)}
                            </div>
                          </div>
                        </div>

                        {/* Action buttons */}
                        <div className="flex gap-2 flex-shrink-0">
                          <button
                            className="action-btn action-btn-edit"
                            onClick={(e) => {
                              e.stopPropagation();
                              openEditModal(session);
                            }}
                          >
                            <svg width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2">
                              <path d="M11 4l3 3L7 14H4v-3L11 4z"></path>
                            </svg>
                          </button>
                          <button
                            className="action-btn action-btn-delete"
                            onClick={(e) => {
                              e.stopPropagation();
                              deleteSession(session.id);
                            }}
                          >
                            <svg width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2">
                              <path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2m3 0v12a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6h14"></path>
                              <line x1="10" y1="11" x2="10" y2="17"></line>
                              <line x1="14" y1="11" x2="14" y2="17"></line>
                            </svg>
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                ))
              )}
            </div>

            {/* Pagination */}
            {totalPages > 1 && (
              <div className="flex justify-center items-center gap-2 flex-wrap">
                <button
                  className="pagination-btn"
                  onClick={() => setCurrentPage(prev => Math.max(1, prev - 1))}
                  disabled={currentPage === 1}
                >
                  ‚Äπ Previous
                </button>

                {[...Array(totalPages)].map((_, i) => {
                  const pageNum = i + 1;
                  if (
                    pageNum === 1 ||
                    pageNum === totalPages ||
                    (pageNum >= currentPage - 1 && pageNum <= currentPage + 1)
                  ) {
                    return (
                      <button
                        key={pageNum}
                        className={`pagination-btn ${currentPage === pageNum ? 'active' : ''}`}
                        onClick={() => setCurrentPage(pageNum)}
                      >
                        {pageNum}
                      </button>
                    );
                  } else if (pageNum === currentPage - 2 || pageNum === currentPage + 2) {
                    return <span key={pageNum} className="text-slate-500">...</span>;
                  }
                  return null;
                })}

                <button
                  className="pagination-btn"
                  onClick={() => setCurrentPage(prev => Math.min(totalPages, prev + 1))}
                  disabled={currentPage === totalPages}
                >
                  Next ‚Ä∫
                </button>
              </div>
            )}
          </div>

          {/* Modal System */}
          {showModal && modalType === 'view' && selectedSession && (
            <div className="modal-backdrop" onClick={closeModal}>
              <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                {/* Header */}
                <div className="p-4 border-b border-slate-700 flex items-center justify-between">
                  <div>
                    <h2 className="text-xl font-bold flex items-center gap-2">
                      {getSessionIcon(selectedSession.sessionType)} {selectedSession.sessionType}
                    </h2>
                    <p className="text-sm text-slate-400">{formatDate(selectedSession.date)} ‚Ä¢ {selectedSession.phase}</p>
                  </div>
                  <button onClick={closeModal} className="text-slate-400 hover:text-white text-2xl">√ó</button>
                </div>

                {/* Content */}
                <div className="p-4 space-y-4">
                  {/* Performance Metrics */}
                  <div className="grid grid-cols-2 gap-3">
                    <div className="metric-card">
                      <h4 className="text-xs text-slate-400 mb-1">Distance</h4>
                      <div className="text-xl font-bold text-cyan-400">{(selectedSession.distance || 0).toFixed(1)} km</div>
                    </div>
                    <div className="metric-card">
                      <h4 className="text-xs text-slate-400 mb-1">Duration</h4>
                      <div className="text-xl font-bold text-emerald-400">{Math.round(selectedSession.duration || 0)} min</div>
                    </div>
                    <div className="metric-card">
                      <h4 className="text-xs text-slate-400 mb-1">Avg Pace</h4>
                      <div className="text-xl font-bold text-indigo-400 mono">{formatPace(selectedSession.avgPace)}</div>
                    </div>
                    <div className="metric-card">
                      <h4 className="text-xs text-slate-400 mb-1">RPE</h4>
                      <div className="text-xl font-bold text-amber-400">{selectedSession.rpe || '--'}/10</div>
                    </div>
                  </div>

                  {/* Heart Rate */}
                  {(selectedSession.avgHr || selectedSession.maxHr) && (
                    <div className="grid grid-cols-2 gap-3">
                      {selectedSession.avgHr && (
                        <div className="metric-card">
                          <h4 className="text-xs text-slate-400 mb-1">Avg HR</h4>
                          <div className="text-xl font-bold text-rose-400">{selectedSession.avgHr} bpm</div>
                        </div>
                      )}
                      {selectedSession.maxHr && (
                        <div className="metric-card">
                          <h4 className="text-xs text-slate-400 mb-1">Max HR</h4>
                          <div className="text-xl font-bold text-rose-300">{selectedSession.maxHr} bpm</div>
                        </div>
                      )}
                    </div>
                  )}

                  {/* Zone Data */}
                  {(selectedSession.z2Pace || selectedSession.z2Time || selectedSession.avgCadence) && (
                    <div className="card p-3 bg-blue-900/10 border-blue-700/30">
                      <h4 className="text-sm font-semibold text-blue-300 mb-2">Zone & Performance Data</h4>
                      <div className="grid grid-cols-2 gap-3 text-sm">
                        {selectedSession.z2Pace && (
                          <div>
                            <div className="text-slate-400">Z2 Pace</div>
                            <div className="font-semibold mono">{formatPace(selectedSession.z2Pace)}</div>
                          </div>
                        )}
                        {selectedSession.z2Time && (
                          <div>
                            <div className="text-slate-400">Time in Z2</div>
                            <div className="font-semibold">{selectedSession.z2Time} min</div>
                          </div>
                        )}
                        {selectedSession.avgCadence && (
                          <div>
                            <div className="text-slate-400">Avg Cadence</div>
                            <div className="font-semibold">{selectedSession.avgCadence} spm</div>
                          </div>
                        )}
                      </div>
                    </div>
                  )}

                  {/* Notes */}
                  {selectedSession.notes && (
                    <div className="card p-3 bg-slate-800/50">
                      <h4 className="text-sm font-semibold text-slate-300 mb-1">Notes</h4>
                      <p className="text-sm text-slate-400">{selectedSession.notes}</p>
                    </div>
                  )}
                </div>

                {/* Footer */}
                <div className="p-4 border-t border-slate-700 flex gap-2">
                  <button className="btn btn-primary flex-1" onClick={() => {
                    setModalType('edit');
                    setEditingSession(selectedSession);
                  }}>
                    Edit Session
                  </button>
                  <button className="btn btn-secondary" onClick={closeModal}>Close</button>
                </div>
              </div>
            </div>
          )}

          {/* Add/Edit Modal */}
          {showModal && (modalType === 'add' || modalType === 'edit') && (
            <div className="modal-backdrop" onClick={closeModal}>
              <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                {/* Header */}
                <div className="p-4 border-b border-slate-700 flex items-center justify-between">
                  <h2 className="text-xl font-bold">
                    {modalType === 'add' ? '‚ûï Add' : '‚úèÔ∏è Edit'} Session
                  </h2>
                  <button onClick={closeModal} className="text-slate-400 hover:text-white text-2xl">√ó</button>
                </div>

                {/* Form */}
                <div className="p-4 space-y-4">
                  {/* Session Type */}
                  <div>
                    <label className="block text-sm font-semibold text-slate-400 mb-2">Session Type *</label>
                    <select id="modalSessionType" className="input-field" defaultValue={editingSession?.sessionType || 'Easy Run'}>
                      <option value="Easy Run">Easy Run</option>
                      <option value="Long Run">Long Run</option>
                      <option value="Tempo Run">Tempo Run</option>
                      <option value="Speed Intervals">Speed Intervals</option>
                      <option value="Recovery Run">Recovery Run</option>
                      <option value="Futsal">Futsal</option>
                      <option value="Pedicab">Pedicab</option>
                      <option value="Strength Training">Strength Training</option>
                      <option value="Cross-Training">Cross-Training</option>
                    </select>
                  </div>

                  {/* Date & Phase */}
                  <div className="grid grid-cols-2 gap-3">
                    <div>
                      <label className="block text-sm font-semibold text-slate-400 mb-2">Date *</label>
                      <input
                        type="date"
                        id="modalDate"
                        className="input-field"
                        defaultValue={editingSession?.date || new Date().toISOString().split('T')[0]}
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-semibold text-slate-400 mb-2">Phase *</label>
                      <select id="modalPhase" className="input-field" defaultValue={editingSession?.phase || 'Base'}>
                        <option value="Base">Base</option>
                        <option value="Build">Build</option>
                        <option value="Specialty">Specialty</option>
                        <option value="Taper">Taper</option>
                      </select>
                    </div>
                  </div>

                  {/* Pedicab Hours */}
                  {editingSession?.sessionType === 'Pedicab' && (
                    <div className="card p-3 bg-amber-900/10 border-amber-700/30">
                      <label className="block text-sm font-semibold text-slate-400 mb-2">Hours Worked *</label>
                      <input
                        type="number"
                        id="modalPedicabHours"
                        className="input-field"
                        placeholder="6"
                        step="0.5"
                        min="0"
                        defaultValue={editingSession?.duration ? (editingSession.duration / 60).toFixed(1) : '6'}
                      />
                      <p className="text-xs text-amber-300 mt-2">
                        ‚ÑπÔ∏è Auto-fills: Distance = hours √ó 3km, Pace 6:30, HR 120/145, RPE 5
                      </p>
                    </div>
                  )}

                  {/* Futsal Info */}
                  {editingSession?.sessionType === 'Futsal' && (
                    <div className="card p-3 bg-purple-900/10 border-purple-700/30">
                      <p className="text-sm text-purple-300">
                        ‚ÑπÔ∏è Auto-fills: 60min, 8km, 7:30 pace, HR 165/185, RPE 8
                      </p>
                    </div>
                  )}

                  {/* Running Fields */}
                  {editingSession?.sessionType !== 'Pedicab' && editingSession?.sessionType !== 'Futsal' && (
                    <>
                      <div className="grid grid-cols-2 gap-3">
                        <div>
                          <label className="block text-sm font-semibold text-slate-400 mb-2">Distance (km)</label>
                          <input
                            type="number"
                            id="modalDistance"
                            className="input-field"
                            placeholder="10.5"
                            step="0.1"
                            min="0"
                            defaultValue={editingSession?.distance || ''}
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-semibold text-slate-400 mb-2">Duration (min)</label>
                          <input
                            type="number"
                            id="modalDuration"
                            className="input-field"
                            placeholder="66"
                            min="0"
                            defaultValue={editingSession?.duration || ''}
                          />
                        </div>
                      </div>

                      <div className="grid grid-cols-2 gap-3">
                        <div>
                          <label className="block text-sm font-semibold text-slate-400 mb-2">Avg Pace (MM:SS)</label>
                          <input
                            type="text"
                            id="modalAvgPace"
                            className="input-field"
                            placeholder="6:30"
                            defaultValue={editingSession?.avgPace ? formatPace(editingSession.avgPace) : ''}
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-semibold text-slate-400 mb-2">RPE (1-10)</label>
                          <input
                            type="number"
                            id="modalRpe"
                            className="input-field"
                            placeholder="7"
                            min="1"
                            max="10"
                            defaultValue={editingSession?.rpe || ''}
                          />
                        </div>
                      </div>

                      <div className="grid grid-cols-2 gap-3">
                        <div>
                          <label className="block text-sm font-semibold text-slate-400 mb-2">Avg HR (bpm)</label>
                          <input
                            type="number"
                            id="modalAvgHr"
                            className="input-field"
                            placeholder="142"
                            min="0"
                            defaultValue={editingSession?.avgHr || ''}
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-semibold text-slate-400 mb-2">Max HR (bpm)</label>
                          <input
                            type="number"
                            id="modalMaxHr"
                            className="input-field"
                            placeholder="165"
                            min="0"
                            defaultValue={editingSession?.maxHr || ''}
                          />
                        </div>
                      </div>

                      {/* Zone Data */}
                      <div className="card p-3 bg-blue-900/10 border-blue-700/30 space-y-3">
                        <h4 className="text-sm font-semibold text-blue-300">Zone & Performance Data (Optional)</h4>
                        <div className="grid grid-cols-2 gap-3">
                          <div>
                            <label className="block text-xs text-slate-400 mb-1">Avg Z2 Pace (MM:SS)</label>
                            <input
                              type="text"
                              id="modalZ2Pace"
                              className="input-field"
                              placeholder="6:30"
                              defaultValue={editingSession?.z2Pace ? formatPace(editingSession.z2Pace) : ''}
                            />
                          </div>
                          <div>
                            <label className="block text-xs text-slate-400 mb-1">Time in Z2 (min)</label>
                            <input
                              type="number"
                              id="modalZ2Time"
                              className="input-field"
                              placeholder="40"
                              min="0"
                              defaultValue={editingSession?.z2Time || ''}
                            />
                          </div>
                        </div>
                        <div>
                          <label className="block text-xs text-slate-400 mb-1">Avg Cadence (spm)</label>
                          <input
                            type="number"
                            id="modalAvgCadence"
                            className="input-field"
                            placeholder="168"
                            min="140"
                            max="200"
                            defaultValue={editingSession?.avgCadence || ''}
                          />
                        </div>
                      </div>
                    </>
                  )}

                  {/* Notes */}
                  <div>
                    <label className="block text-sm font-semibold text-slate-400 mb-2">Notes</label>
                    <textarea
                      id="modalNotes"
                      className="input-field"
                      placeholder="How did the session feel?"
                      rows="3"
                      defaultValue={editingSession?.notes || ''}
                    ></textarea>
                  </div>
                </div>

                {/* Footer */}
                <div className="p-4 border-t border-slate-700 flex gap-2">
                  <button className="btn btn-primary flex-1" onClick={handleSaveSession}>
                    {modalType === 'add' ? 'Add Session' : 'Save Changes'}
                  </button>
                  <button className="btn btn-secondary" onClick={closeModal}>Cancel</button>
                </div>
              </div>
            </div>
          )}

          <BottomNav currentPage="history" />
        </div>
      );
    }

    ReactDOM.render(<TrainingHistory />, document.getElementById('root'));
  </script>
</body>
</html>
